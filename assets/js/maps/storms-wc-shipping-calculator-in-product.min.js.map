{"version":3,"sources":["storms-wc-shipping-calculator-in-product.min.js"],"names":["jQuery","$","storms_wc_shipping_calculator_in_product_vars","show_notice","html_element","$target","closest","prepend","removeResponseBlock","$shipping_calculator_rates","length","remove","mask","attr","document","body","on","event","preventDefault","$btn_add_to_cart","$input_variation_id","$wrapper","this","parents","country","val","state","city","postcode","product_id","$node","$quantity_field","quantity","data","security","is","addClass","block","message","overlayCSS","background","opacity","ajax","url","ajax_url","toString","type","dataType","success","response","after","html","error","complete","removeClass","unblock","jqXHR","debug_mode","console","log","responseText"],"mappings":"AAAA,aAOAA,OAAO,SAAUC,GAEf,GAA6D,oBAAlDC,8CACT,OAAO,EAgDS,SAAdC,EAAmCC,EAAcC,IAEjDA,EADGA,IACOJ,EAAE,uCAAyCA,EAAE,eAAeK,QAAQ,iBAAmBL,EAAE,4BAG7FM,QAAQH,GAGQ,SAAtBI,IACF,IAAIC,EAA6BR,EAAE,8BAEK,EAApCQ,EAA2BC,QAC7BD,EAA2BE,SA8B/BV,EAAE,2BAA2BW,KAAK,aAAaC,KAAK,OAAQ,OAC5DZ,EAAEa,SAASC,MAAMC,GAAG,QAAS,+BAAgC,SAAUC,GACrEA,EAAMC,iBACN,IApBIC,EAEAC,EAkBAC,EAAWpB,EAAEqB,MAAMC,QAAQ,6BAE3BC,EADiBvB,EAAE,0BACMwB,MAEzBC,EADezB,EAAE,wBACIwB,MAErBE,EADc1B,EAAE,uBACGwB,MAEnBG,EADkB3B,EAAE,2BACOwB,MAC3BI,GA7BAV,EAAmBlB,EAAE,wBAMQ,GAJ7BmB,EAAsBnB,EAAE,0BAIJS,OACa,EAA5BU,EAAoBK,OAAYL,EAAoBK,MAE7B,EAA1BN,EAAiBT,QACa,EAAzBS,EAAiBM,OAAYN,EAAiBM,OAqBzD,GAAmB,IAAfI,EAAJ,CAKA,IAzFyBC,EAVUA,EAmG/BC,EAAkB9B,EAAE,uBACpB+B,EAAWD,EAAgBrB,OAASqB,EAAgBN,MAAQ,EAG5DQ,EAAO,CACTC,SAHiBjC,EAAE,yBACIwB,MAGvBD,QAASA,EACTE,MAAOA,EACPC,KAAMA,EACNC,SAAUA,EACVC,WAAYA,EACZG,SAAUA,IA9GuBF,EAUVA,EAsGnBT,GA/GOc,GAAG,gBAAkBL,EAAMP,QAAQ,eAAeb,QAW7DoB,EAAMM,SAAS,cAAcC,MAAM,CACjCC,QAAS,KACTC,WAAY,CACVC,WAAY,OACZC,QAAS,MAiGfxC,EAAEyC,KAAK,CACLC,IAAKzC,8CAA8C0C,SAASC,WAAa,yBACzEC,KAAM,OACNb,KAAMA,EACNc,SAAU,OACVC,QAAS,SAAiBC,GACxBhD,EAAE,+DAA+DU,SAE7DsC,IACEA,EAASD,SACXxC,IACsBP,EAAE,6BACRiD,MAAM,mFAAqFD,EAAShB,KAAKkB,KAAO,aAEhIhD,EAAY,+CAAiD8C,EAAShB,KAAKmB,MAAQ,YAIzFC,SAAU,WACAhC,EAvGNiC,YAAY,cAAcC,WAyG9BH,MAAO,SAAeI,GACpBhD,IAEIN,8CAA8CuD,YAEhDC,QAAQC,IAAIH,EAAMI,sBA5CtBzD,EAAY","file":"../storms-wc-shipping-calculator-in-product.min.js","sourcesContent":["\"use strict\";\n\n/**\r\n *\r\n */\n\n/* global storms_wc_shipping_calculator_in_product_vars */\njQuery(function ($) {\n  // storms_wc_shipping_calculator_in_product_vars is required to continue, ensure the object exists\n  if (typeof storms_wc_shipping_calculator_in_product_vars === 'undefined') {\n    return false;\n  }\n  /**\r\n   * Check if a node is blocked for processing.\r\n   *\r\n   * @param {JQuery Object} $node\r\n   * @return {bool} True if the DOM Element is UI Blocked, false if not.\r\n   */\n\n\n  var is_blocked = function is_blocked($node) {\n    return $node.is('.processing') || $node.parents('.processing').length;\n  };\n  /**\r\n   * Block a node visually for processing.\r\n   *\r\n   * @param {JQuery Object} $node\r\n   */\n\n\n  var block = function block($node) {\n    if (!is_blocked($node)) {\n      $node.addClass('processing').block({\n        message: null,\n        overlayCSS: {\n          background: '#fff',\n          opacity: 0.6\n        }\n      });\n    }\n  };\n  /**\r\n   * Unblock a node after processing is complete.\r\n   *\r\n   * @param {JQuery Object} $node\r\n   */\n\n\n  var unblock = function unblock($node) {\n    $node.removeClass('processing').unblock();\n  };\n  /**\r\n   * Shows new notices on the page.\r\n   *\r\n   * @param {Object} The Notice HTML Element in string or object form.\r\n   */\n\n\n  var show_notice = function show_notice(html_element, $target) {\n    if (!$target) {\n      $target = $('.woocommerce-notices-wrapper:first') || $('.cart-empty').closest('.woocommerce') || $('.woocommerce-cart-form');\n    }\n\n    $target.prepend(html_element);\n  };\n\n  var removeResponseBlock = function removeResponseBlock() {\n    var $shipping_calculator_rates = $('#shipping-calculator-rates');\n\n    if ($shipping_calculator_rates.length > 0) {\n      $shipping_calculator_rates.remove();\n    }\n  };\n  /**\r\n   * Get the product/variation id\r\n   * TODO group and external products\r\n   *\r\n   * @returns {boolean|int}\r\n   */\n\n\n  var get_product_id = function get_product_id() {\n    // Simple product\n    var $btn_add_to_cart = $('[name=\"add-to-cart\"]'); // Variable product\n\n    var $input_variation_id = $('[name=\"variation_id\"]');\n    var product_id = 0;\n    var variation_id = 0;\n\n    if ($input_variation_id.length > 0) {\n      return $input_variation_id.val() > 0 ? $input_variation_id.val() : false;\n    } else {\n      if ($btn_add_to_cart.length > 0) {\n        return $btn_add_to_cart.val() > 0 ? $btn_add_to_cart.val() : false;\n      }\n    }\n\n    return false;\n  };\n\n  $('#calc_shipping_postcode').mask('00000-000').attr('type', 'tel');\n  $(document.body).on('click', 'button[name=\"calc_shipping\"]', function (event) {\n    event.preventDefault();\n    var $wrapper = $(this).parents('.shipping-calculator-form');\n    var $country_field = $('#calc_shipping_country');\n    var country = $country_field.val();\n    var $state_field = $('#calc_shipping_state');\n    var state = $state_field.val();\n    var $city_field = $('#calc_shipping_city');\n    var city = $city_field.val();\n    var $postcode_field = $('#calc_shipping_postcode');\n    var postcode = $postcode_field.val();\n    var product_id = get_product_id();\n\n    if (product_id === 0) {\n      show_notice('<div class=\"woocommerce-error\" role=\"alert\">Por favor, escolha uma opção antes de calcular o frete.</div>');\n      return;\n    }\n\n    var $quantity_field = $('.quantity input.qty');\n    var quantity = $quantity_field.length ? $quantity_field.val() : 1;\n    var $nonce_field = $('#storms-wc-scip-nonce');\n    var nonce = $nonce_field.val();\n    var data = {\n      security: nonce,\n      country: country,\n      state: state,\n      city: city,\n      postcode: postcode,\n      product_id: product_id,\n      quantity: quantity\n    };\n    block($wrapper);\n    $.ajax({\n      url: storms_wc_shipping_calculator_in_product_vars.ajax_url.toString() + '?action=storms_wc_scip',\n      type: 'POST',\n      data: data,\n      dataType: 'json',\n      success: function success(response) {\n        $('.woocommerce-error, .woocommerce-message, .woocommerce-info').remove();\n\n        if (response) {\n          if (response.success) {\n            removeResponseBlock();\n            var $response_field = $('.shipping-calculator-form');\n            $response_field.after('<table id=\"shipping-calculator-rates\" class=\"shop_table shop_table_responsive \">' + response.data.html + '</table>');\n          } else {\n            show_notice('<div class=\"woocommerce-error\" role=\"alert\">' + response.data.error + '</div>');\n          }\n        }\n      },\n      complete: function complete() {\n        unblock($wrapper);\n      },\n      error: function error(jqXHR) {\n        removeResponseBlock();\n\n        if (storms_wc_shipping_calculator_in_product_vars.debug_mode) {\n          /* jshint devel: true */\n          console.log(jqXHR.responseText);\n        }\n      }\n    });\n  });\n});"]}